    DEVICE ZXSPECTRUM48
    ORG $8000
    LD SP, 0
    LD A, 0 ; VALOR INICIAL DE A
    OUT ($FE), A ; COLOREA EL MARCO DE LA PANTALLA NEGRO
    JP INICIO
CONTADOR EQU 255
    INCLUDE "colors.asm"
    INCLUDE "graphics_basic.asm"
    INCLUDE "graphics_core.asm"
    INCLUDE "keyboard.asm"
    INCLUDE "logic_checks.asm"
    INCLUDE "logic_flow.asm"
    INCLUDE "variables.asm"

INICIO:
    CALL GB_BIENVENIDA
    CALL K_SON
    ; SI SE DETECTO NO
    ; CALL (CONDICION DE DETECCION), ADIOS
    ; SI SE DETECTO SI
    ; CALL (CONDICION DE DETECCION), LOGICA_JUEGO

ADIOS:
    CALL GB_ADIOS
    HALT

FIN_NEXT: ; TERMINO LA PARTIDA
    CALL GB_FIN_NEXT
    CALL K_SON
    ; SI SE DETECTO NO
    ; CALL (CONDICION DE DETECCION), ADIOS
    ; SI SE DETECTO SI
    ; CALL (CONDICION DE DETECCION), LOGICA_JUEGO

LOGICA_JUEGO:
    CALL GB_PTLLA_INICIO_DE_JUEGO
    CALL LF_INICIALIZACION
BUCLE_JUEGO:
    CALL LF_SWITCH_JUGADOR
GESTIONAR_JUGADA:
    CALL GC_COLOR_JUGADOR_ACTUAL
    CALL K_LR_ENTER
    CALL LF_VALIDPLAY
    ; SI SE DETECTO LEFT
    ; CALL (CONDICION DE DETECCION), GC_LEFT
    ; SI SE DETECTO RIGHT
    ; CALL (CONDICION DE DETECCION), GC_RIGHT
    ; SI SE DETECTO ENTER
    ; CALL (CONDICION DE DETECCION), GC_ENTER
COMPROBAR_FIN_JUEGO:
    CALL LC_COMPROBAR_FIN
    ; SI SE DETECTO EL FIN DEL JUEGO
    ; JR (CONDICION DE FIN), FIN_NEXT
    ; SI SE DETECTA QUE EL JUEGO SIGUE
    JR BUCLE_JUEGO

COORD_ATRIB:
; PREREQUISITO: HABER SELECCIONADO UNA FILA Y UNA COLUMNA (H Y L) SOBRE LA QUE SE QUIERE OBTENER UNA DIRECCIÓN VIDEORAM
; H = FILA
; L = COLUMNA
; HL = DIRECCIÓN DE LA VIDEORAM

    PUSH AF
    LD A, H ; 0 0 0 H4 H3 H2 H1 H0
    SLA A: SLA A: SLA A: SLA A: SLA A ; H2 H1 H0 0 0 0 0 0
    OR L ; H2 H1 H0 L4 L3 L2 L1 L0
    LD A, H ; 0 0 0 H4 H3 H2 H1 H0
    SRA A: SRA A: SRA A; 0 0 0 0 0 0 H4 H3 
    OR $58 ; 0 1 0 1 1 0 H4 H3
    ; HL = 0 1 0 1 1 0 H4 H3 H2 H1 H0 L4 L3 L2 L1 L0
    POP AF
    RET


